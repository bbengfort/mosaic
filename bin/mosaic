#!/usr/bin/env python
# fsstat
# Inspects the mimetype distribution of a directory.
#
# Author:   Benjamin Bengfort <benjamin@bengfort.com>
# Created:  Tue Nov 24 15:09:19 2015 -0500
#
# Copyright (C) 2015 Bengfort.com
# For license information, see LICENSE.txt
#
# ID: fsstat.py [] benjamin@bengfort.com $

"""
Inspects the mimetype distribution of a directory.
"""

##########################################################################
## Imports
##########################################################################

import sys
import time
import mosaic
import argparse

from mosaic.usage import analyze

##########################################################################
## Module Constants
##########################################################################

PROG = {
    "version": mosaic.get_version(),
    "epilog": "Created for scientific purposes and not diagnostic ones.",
    "description": "Inspects the mimetype distribution of a directory.",
}

##########################################################################
## Main Method and functionality
##########################################################################

def main(*argv):

    parser = argparse.ArgumentParser(**PROG)
    parser.add_argument('-I', '--include-hidden', action='store_true', help='include hidden files and directories')
    parser.add_argument('path', nargs=1, help='path of directory to inspect')

    args = parser.parse_args()

    try:
        usage = analyze(args.path[0], args.include_hidden)
        with open('mosaic-{}.json'.format(int(time.time())), 'w') as f:
            usage.dump(f, indent=2)

        print usage
    except Exception as e:
        parser.error(str(e))

if __name__ == "__main__":
    main(*sys.argv[1:])
